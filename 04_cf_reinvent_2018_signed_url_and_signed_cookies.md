# CloudFront re:invent 2018 - Signed URL and signed cookies

## Serving Private Content with Signed URLs and Signed Cookies

### Check that you have access to the content

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/
1. Search for the distribution without trusted signers (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST04B** in the comments)
1. Copy the **Domain Name** and try to access to: *"https://{CFDomainName}/index.html"*
1. The HTTP response code should be **200 (Success)**

### Creating CloudFront Key Pairs for Your Trusted Signers

1. Sign in to the AWS Management Console using the root credentials for an AWS account (https://console.aws.amazon.com/)
  * IAM users can't create CloudFront key pairs. You must log in using root credentials to create key pairs.
1. On the account-name menu, click **Security Credentials**
1. Expand **CloudFront Key Pairs**
1. Confirm that you have no more than one active key pair. You can't create a key pair if you already have two active key pairs
1. Click **Create New Key Pair**
1. In the **Create Key Pair** dialog box, click **Download Private Key File**
1. Record the key pair ID for your key pair. (In the AWS Management Console, this is called the access key ID) You'll use it when you create signed URLs or signed cookies

### Adding Trusted Signers to Your Distribution Using the CloudFront Console

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/
1. Search for the distribution without trusted signers (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST04B** in the comments)
1. Click on the distribution, and then choose **Distribution Settings**
1. In the Distribution Settings pane, choose the **Behavior** tab
1. Choose the default cache behavior, and then choose **Edit**
1. For **Restrict Viewer Access** (Use Signed URLs or Signed Cookies), click **Yes**
1. For Trusted Signers, check **Self**
1. Click **Yes, Edit**
1. Wait for the new configuration to be propagated

### Results

1. Since propagation takes ~10 minutes, a distribution with trusted signers enabled was created as part of the CFN templates
1. Search for the distribution with trusted signers (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST04A** in the comments)
1. Copy the **Domain Name** and try to access to: *"https://{CFDomainName}/index.html"*
1. The HTTP response code should be **403 (Forbidden)**

#### Using Signed URLs

* Execute the following commands:

```bash
% ./04_signed_url_and_signed_cookies/signedurls.sh --domain <CF_DOMAIN_NAME> --pk <PATH_TO_PK> --keyid <KEY_ID>"
# i.e. ./04_signed_url_and_signed_cookies/signedurls.sh --domain d123.cloudfront.net --pk ./pk-APKAJAGXLDV2OEXAMPLE.pem --keyid APKAJAGXLDV2OEXAMPLE
```

* The HTTP response code should be **200 (Success)**

#### Using Signed Cookies

* Execute the following commands:

```bash
% ./04_signed_url_and_signed_cookies/signedcookies.sh --domain <CF_DOMAIN_NAME> --pk <PATH_TO_PK> --keyid <KEY_ID>"
# i.e. ./04_signed_url_and_signed_cookies/signedcookies.sh --domain d123.cloudfront.net --pk ./pk-APKAJAGXLDV2OEXAMPLE.pem --keyid APKAJAGXLDV2OEXAMPLE
```

* The HTTP response code should be **200 (Success)**
