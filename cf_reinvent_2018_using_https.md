# CloudFront re:invent 2018 - Using HTTPS

## Configuring custom SSL for viewer connections to your distribution

### Review the default distribution

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/
1. Search for the distribution with a custom origin (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST01** in the comments)
1. Notice that by default the distribution is configured to the cloudfront default certificate.
1. Copy the domain name (i.e. d123.cloudfront.net) to the browser and connect the distribution over both http and https.  
1. Notice that both protocols are accepted.

### Upload a custom certificate to Amazon Certificate Manager

1. Sign in to the AWS Management Console and open the Certificate Manager console at https://console.aws.amazon.com/acm
1. Click on the **Import a Certificate** button
1. Copy and paste the certificate body, certificate private key, and certificate chain provided from this lab and click **Import** 


### Configure a custom SSL certificate for viewer connections

1. Open the CloudFront console at https://console.aws.amazon.com/cloudfront/
1. Search for the distribution with a custom origin (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST01** in the comments)
1. On the **General** click **Edit**
1. Type the instructor provided subdomain into the CNAME field.
1. Select the **Custom SSL Certificate** radio button
1. Select the ACM certificate uploaded in the previous step (*.awsedgeservices.com)
1. Notice the option to configure different security policies.  In this lab we will leave it to the default value (TLSv1.1_2016)
1. Click **Yes, Edit**.

### Configure SSL to the origin

1. Click on the **Origins** tab
1. Select the origin with the Origin ID  **alb-origin** and click **Edit**
1. Next to Origin SSL Protocol, de-select SSLv3 and select TLSv1.2
1. Next to Origin Protocol policy, select **HTTPS Only**
1. Click **Yes, Edit**

### Configure the cache behavior to only accept requests over SSL

1. Click on the **Behaviors** tab
1. Select the Default cache behavior and click the **Edit** button
1. Next to viewer protocol policy select **Redirect HTTP to HTTPS**
1. Click **Yes, Edit**

### Results

1. Give the changes ~10 minutes to propagate.
1. Copy the *Custom Domain Name** and try to access to: *"http://{DomainName}"*
1. Notice that the url was redirected to: *"https://{DomainName}"*
1. Notice the certificate served is the one configured from ACM.
1. Note that all requests from cloudfront to the origin are now only sent over SSL.


