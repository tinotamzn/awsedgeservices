# CloudFront re:invent 2018 - Origin access identity

## Creating a CloudFront Origin Access Identity and Adding it to Your Distribution

### Check that you do not have access to the content

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/
1. Search for the distribution without OAI (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST02B** in the comments)
1. Copy the **Domain Name** and try to access to: *"https://{CFDomainName}/index.html"*
1. The HTTP response code should be **403 (Forbidden)**
1. Try to access the following url: *https://s3.amazonaws.com/{S3BucketName}/index.html* (you can get the S3BucketName from the **origin**)
1. The HTTP response code should be **403 (Forbidden)**

### To create a CloudFront origin access identity using the CloudFront console

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/
1. Search for the distribution without OAI (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST02B** in the comments)
1. Click on the distribution, and then choose **Distribution Settings**
1. Choose the **Origins** tab
1. Choose the default origin, and then choose **Edit**
1. For **Restrict Bucket Access**, choose **Yes**
1. Click **Create a New Identity**
1. Click **Yes, Update Bucket Policy** so CloudFront will automatically give the origin access identity permission to read the files in the Amazon S3 bucket specified in **Origin Domain Name**
1. Choose **Yes, Edit**
1. Wait for the new configuration to be propagated

### Results

1. Since propagation takes ~10 minutes, a distribution with OAI enabled was created as part of the CFN templates
1. Search for the distribution with OAI (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST02A** in the comments)
1. Copy the **Domain Name** and try to access to: *"https://{CFDomainName}/index.html"*
1. The HTTP response code should be **200 (Success)**
1. Try to access the same file by using the direct S3 url: *https://s3.amazonaws.com/{S3BucketName}/index.html* (you can get the S3BucketName from the **origin**)
1. The HTTP response code should be **403 (Forbidden)**
