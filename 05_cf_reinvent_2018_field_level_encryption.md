# CloudFront re:invent 2018 - Field level encryption
## Encrypting sensitive form parameters with Field level encryption

### Add your public key to be used for encrypting the data

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/.
1. In the navigation pane, choose **Public key**.
1. Choose **Add public key**.
1. For **Key name**, type a unique name for the key. The name can't have spaces and can include only alphanumeric characters, underscores (_), and hyphens (-). The maximum number of characters is 128.
1. For **Encoded key**, from the public_key.pem file provided with this lab copy and paste the encoded key value for your public key, including the " -----BEGIN PUBLIC KEY-----" and "-----END PUBLIC KEY-----" lines.
1. For **Comment**, add an optional comment. For example, you could include the expiration date for the public key.
1. Choose **Add key**.

### Create a Profile for Field Level Encryption

1. In the navigation pane, choose Field-level encryption.
1. Choose Create profile.
1. Fill in the following fields:
    **Profile name**
    Type a unique name for the profile. The name can't have spaces and can include only alphanumeric characters, underscores (_), and hyphens (-). The maximum number of characters is 128.

    **Public key name**
    In the drop-down list, choose the name of a public key that you added to CloudFront in step 2. CloudFront uses the key to encrypt the fields that you specify in this profile.

    **Provider name**
    Type a phrase to help identify the key, such as the provider where you got the key pair. This information, along with the private key, will be needed when applications decrypt data fields. The provider name can't have spaces and can include only alphanumeric characters, colons (:), underscores (_), and hyphens (-). The maximum number of characters is 128.

    **Field name pattern to match**
    Type the names of the data fields, or patterns that identify data field names in the request, that you want CloudFront to encrypt. Choose the + option to add all the fields that you want to encrypt with this key.

    In this lab, we will encrypt the **DOB** and **SSN** parameters, so choose the + option to add both of these fields.

    **Comment**
    (Optional) Type a comment about this profile. The maximum number of characters that you can use is 128.
1. After you fill in the fields, choose Create profile.

### Create a Configuration to specify the content type of the request that includes data to be encrypted and the profile used for encyption

1. On the Field-level encryption page, choose Create configuration.
1. Fill in the following fields to specify the profile to use. (Some fields can't be changed.)

**Content type (can't be changed)**
The content type is set to application/x-www-form-urlencoded and canâ€™t be changed.

**Default profile ID (optional)**
In the drop-down list, choose the profile that you created in the previous steps.

1. Click **Create Configuration**


### Configure your cache behavior

1. On the navigation pane select **Distributions**
1. Search for and select the distribution for Field Level Encryption (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST05** in the comments)
1. Click the **Behaviors** tab 
1. Select the behavior with the path pattern **/LogFLEData** and click the **Edit** button.
1. Next to **Field-level Encryption Config** select the configuration created from the previous steps.
1. Click the **Yes, Edit** button.

### Results
1. On the navigation pane select **Distributions**
1. Search for and select the distribution for Field Level Encryption (this distribution was autogenerated by the CFN templates and should have the ID **CFDIST05** in the comments)
1. Verify that the deployment has completed before proceeding.
1. Copy and paste the distribution domain name to the browser.
1. You should see a test Form with 4 fields.  The first 2 ask for any text and the last 2 ask for a DOB and SSN.  Fill in the form with some pretend data. **DO NOT USE YOUR ACTUAL SSN AND DOB**
1. You should recieve a 200 OK response back with some JSON representing what was recieved by the origin server.  Notice the body of the request have encrypted values for the SSN and DOB fields.  Also notice that the first 2 text fields were untouched.